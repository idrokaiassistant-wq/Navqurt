# Dokploy deployment configuration
# Bu fayl Dokploy'da GitHub integration sozlashda yordam beradi

version: '1.0'

# GitHub repository ma'lumotlari
repository:
  url: https://github.com/idrokaiassistant-wq/Navqurt.git
  branch: main

# Build sozlamalari
build:
  context: .
  dockerfile: web/Dockerfile
  
# Environment variables (Dokploy UI'da sozlanadi)
# Quyidagilar .env faylda bo'lishi kerak:
# - DATABASE_URL
# - NEXTAUTH_SECRET
# - NEXTAUTH_URL
# - ADMIN_EMAIL (ixtiyoriy)
# - ADMIN_PASSWORD (ixtiyoriy)

# Port sozlamalari
ports:
  - "3000:3000"

# Health check - improved configuration
healthcheck:
  test: ["CMD", "node", "-e", "require('http').get('http://localhost:3000/api/health', (r) => {r.on('error', () => process.exit(1)); r.on('data', () => {}); r.on('end', () => process.exit(r.statusCode === 200 ? 0 : 1))}).on('error', () => process.exit(1)).setTimeout(8000, () => process.exit(1))"]
  interval: 30s
  timeout: 10s
  retries: 3
  start_period: 60s

# Resource limits (set these in Dokploy UI if supported, or in docker-compose.yml)
# Recommended production settings:
# - memory: 512m (minimum) to 1g (recommended)
# - memory_reservation: 256m
# - cpus: '1.0' (1 core)
# - memory_swap: 1g (if swap is available)
#
# To set in Dokploy:
# 1. Go to Project → Settings → Advanced
# 2. Set Memory Limit: 512 MB - 1 GB
# 3. Set CPU Limit: 1.0
# 4. Enable Resource Limits checkbox




